{"ast":null,"code":"import buttnNoLikeImage from'../../images/button-noLike__image.svg';import deleteButton from'../../images/delete__button.svg';import{Link,useLocation}from\"react-router-dom\";import React,{useEffect,useState}from\"react\";import buttonLikeImage from'../../images/button-like__image.svg';import{mainApi}from\"../../utils/MainApi\";import{CurrentUserContext}from\"../../contexts/CurrentUserContext\";import{UsersMovies}from\"../../contexts/UsersMovies\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MoviesCard(_ref){let{movie,savedMovies,openPopupError,updateMoviesList,handleUpdateUsersMovies}=_ref;const[isLiked,setIsLiked]=useState(false);const[likedMovies,setLikedMovies]=useState([]);const[movieDelete,setMovieDelete]=useState([]);const addedMovies=React.useContext(UsersMovies);const profileData=React.useContext(CurrentUserContext);useEffect(()=>{if(savedMovies&&savedMovies.length>0){const likedMovies=savedMovies.some(item=>item.movieId===movie.id);if(likedMovies){setIsLiked(true);}}},[movie.id,savedMovies]);function numberToTime(number){const hours=Math.floor(number/60);const minutes=number%60;return\"\".concat(hours,\"\\u0447\").concat(minutes,\"\\u043C\");}function changeLikeState(){setIsLiked(!isLiked);const movieDublicate={image:\"https://api.nomoreparties.co\".concat(movie.image.url),trailerLink:movie.trailerLink,thumbnail:'https://api.nomoreparties.co'+movie.image.url,movieId:movie.id,country:movie.country,director:movie.director,duration:movie.duration,year:movie.year,description:movie.description,nameRU:movie.nameRU,nameEN:movie.nameEN,owner:profileData._id};if(!isLiked){//setLikedMovies(prevLikedMovies => [...prevLikedMovies, movieDublicate]);\nhandleUpdateUsersMovies(prevLikedMovies=>[...prevLikedMovies,movieDublicate]);// mainApi.addMovie(movieDublicate)\n// .then((res) => {\n//     console.log('Фильм успешно добавлен');\n// })\n// .catch((error) => {\n//     console.log('Ошибка при добавлении фильма');\n//     openPopupError(true)\n// });\n}else{// mainApi.getMovies()\n//     .then(async (data) => {\n//         const isMovieInData = data.find(item => item.movieId === movieDublicate.movieId);\n//         if (isMovieInData) {\n//             await mainApi.deleteMovie(isMovieInData._id);\n//             setLikedMovies(prevLikedMovies => prevLikedMovies.filter(item => item.movieId !== isMovieInData.movieId));\n//             console.log('Фильм успешно удален');\n//         }\n//     })\n//     .catch((error) => {\n//         console.log(error);\n//         openPopupError(true)\n//     });\nconst isMovieInData=addedMovies.find(item=>item.movieId===movieDublicate.movieId);if(isMovieInData){handleUpdateUsersMovies(prevLikedMovies=>prevLikedMovies.filter(item=>item.movieId!==isMovieInData.movieId));console.log('Фильм успешно удален');}}}function deleteMovie(movie){// console.log(movie);\n// mainApi.deleteMovie(movie._id)\n//     .then((res) => {\n//         updateMoviesList(movie)\n//         console.log('Фильм успешно удален');\n//     })\n//     .catch((error) => {\n//         console.log('Ошибка при удалении фильма');\n//         openPopupError(true)\n//     });\nconst updatedMovies=addedMovies.filter(item=>item.movieId!==movie.movieId);handleUpdateUsersMovies(updatedMovies);}const{pathname}=useLocation();return/*#__PURE__*/_jsxs(\"div\",{className:\"moviesCard\",children:[/*#__PURE__*/_jsx(Link,{to:movie.trailerLink,target:\"_blank\",children:/*#__PURE__*/_jsx(\"img\",{className:\"moviesCard__image\",src:pathname===\"/movies\"?\"https://api.nomoreparties.co\".concat(movie.image.url):\"\".concat(movie.image),alt:\"\\u0418\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0444\\u0438\\u043B\\u044C\\u043C\\u0430\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"moviesCard__container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"moviesCard__name\",children:movie.nameRU}),pathname===\"/saved-movies\"?/*#__PURE__*/_jsx(\"button\",{className:\"moviesCard__button\",children:/*#__PURE__*/_jsx(\"img\",{src:deleteButton,onClick:()=>deleteMovie(movie),alt:\"\\u0418\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u043A\\u0440\\u0435\\u0441\\u0442\\u0438\\u043A\\u0430\"})}):/*#__PURE__*/_jsx(\"button\",{className:\"moviesCard__button\",children:/*#__PURE__*/_jsx(\"img\",{onClick:changeLikeState,src:isLiked?buttonLikeImage:buttnNoLikeImage,alt:\"\\u0418\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0441\\u0435\\u0440\\u0434\\u0446\\u0430\"})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"moviesCard__movie-time\",children:numberToTime(movie.duration)})]});}export default MoviesCard;","map":{"version":3,"names":["buttnNoLikeImage","deleteButton","Link","useLocation","React","useEffect","useState","buttonLikeImage","mainApi","CurrentUserContext","UsersMovies","jsx","_jsx","jsxs","_jsxs","MoviesCard","_ref","movie","savedMovies","openPopupError","updateMoviesList","handleUpdateUsersMovies","isLiked","setIsLiked","likedMovies","setLikedMovies","movieDelete","setMovieDelete","addedMovies","useContext","profileData","length","some","item","movieId","id","numberToTime","number","hours","Math","floor","minutes","concat","changeLikeState","movieDublicate","image","url","trailerLink","thumbnail","country","director","duration","year","description","nameRU","nameEN","owner","_id","prevLikedMovies","isMovieInData","find","filter","console","log","deleteMovie","updatedMovies","pathname","className","children","to","target","src","alt","onClick"],"sources":["C:/Users/79267/desktop/praktikum/dev/movies-explorer-frontend-no-api/src/components/MoviesCard/MoviesCard.js"],"sourcesContent":["import buttnNoLikeImage from '../../images/button-noLike__image.svg'\r\nimport deleteButton from '../../images/delete__button.svg'\r\nimport { Link, useLocation } from \"react-router-dom\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport buttonLikeImage from '../../images/button-like__image.svg'\r\nimport { mainApi } from \"../../utils/MainApi\";\r\nimport { CurrentUserContext } from \"../../contexts/CurrentUserContext\";\r\nimport { UsersMovies } from \"../../contexts/UsersMovies\";\r\n\r\nfunction MoviesCard({ movie, savedMovies, openPopupError, updateMoviesList, handleUpdateUsersMovies }) {\r\n\r\n    const [isLiked, setIsLiked] = useState(false)\r\n    const [likedMovies, setLikedMovies] = useState([]);\r\n    const [movieDelete, setMovieDelete] = useState([])\r\n\r\n    const addedMovies = React.useContext(UsersMovies);\r\n\r\n    const profileData = React.useContext(CurrentUserContext)\r\n\r\n    useEffect(() => {\r\n        if (savedMovies && savedMovies.length > 0) {\r\n            const likedMovies = savedMovies.some(item => item.movieId === movie.id);\r\n            if (likedMovies) {\r\n                setIsLiked(true);\r\n            }\r\n        }\r\n    }, [movie.id, savedMovies]);\r\n\r\n\r\n    function numberToTime(number) {\r\n        const hours = Math.floor(number / 60);\r\n        const minutes = number % 60;\r\n        return `${hours}ч${minutes}м`;\r\n    }\r\n\r\n    function changeLikeState() {\r\n        setIsLiked(!isLiked);\r\n\r\n        const movieDublicate = {\r\n            image: `https://api.nomoreparties.co${movie.image.url}`,\r\n            trailerLink: movie.trailerLink,\r\n            thumbnail: 'https://api.nomoreparties.co' + movie.image.url,\r\n            movieId: movie.id,\r\n            country: movie.country,\r\n            director: movie.director,\r\n            duration: movie.duration,\r\n            year: movie.year,\r\n            description: movie.description,\r\n            nameRU: movie.nameRU,\r\n            nameEN: movie.nameEN,\r\n            owner: profileData._id\r\n        }\r\n\r\n        if (!isLiked) {\r\n            //setLikedMovies(prevLikedMovies => [...prevLikedMovies, movieDublicate]);\r\n            handleUpdateUsersMovies(prevLikedMovies => [...prevLikedMovies, movieDublicate])\r\n            // mainApi.addMovie(movieDublicate)\r\n            // .then((res) => {\r\n            //     console.log('Фильм успешно добавлен');\r\n            // })\r\n            // .catch((error) => {\r\n            //     console.log('Ошибка при добавлении фильма');\r\n            //     openPopupError(true)\r\n            // });\r\n        } else {\r\n            // mainApi.getMovies()\r\n            //     .then(async (data) => {\r\n            //         const isMovieInData = data.find(item => item.movieId === movieDublicate.movieId);\r\n            //         if (isMovieInData) {\r\n            //             await mainApi.deleteMovie(isMovieInData._id);\r\n            //             setLikedMovies(prevLikedMovies => prevLikedMovies.filter(item => item.movieId !== isMovieInData.movieId));\r\n            //             console.log('Фильм успешно удален');\r\n            //         }\r\n            //     })\r\n            //     .catch((error) => {\r\n            //         console.log(error);\r\n            //         openPopupError(true)\r\n            //     });\r\n            const isMovieInData = addedMovies.find(item => item.movieId === movieDublicate.movieId);\r\n            if (isMovieInData) {\r\n                handleUpdateUsersMovies(prevLikedMovies => prevLikedMovies.filter(item => item.movieId !== isMovieInData.movieId));\r\n                console.log('Фильм успешно удален');\r\n            }\r\n        }\r\n    }\r\n\r\n    function deleteMovie(movie) {\r\n        // console.log(movie);\r\n        // mainApi.deleteMovie(movie._id)\r\n        //     .then((res) => {\r\n        //         updateMoviesList(movie)\r\n        //         console.log('Фильм успешно удален');\r\n        //     })\r\n        //     .catch((error) => {\r\n        //         console.log('Ошибка при удалении фильма');\r\n        //         openPopupError(true)\r\n        //     });\r\n            const updatedMovies = addedMovies.filter(item => item.movieId !== movie.movieId);\r\n            handleUpdateUsersMovies(updatedMovies);\r\n    }\r\n\r\n    const { pathname } = useLocation()\r\n\r\n    return (\r\n        <div className=\"moviesCard\">\r\n            <Link to={movie.trailerLink} target=\"_blank\">\r\n                <img className=\"moviesCard__image\" src={pathname === \"/movies\" ? `https://api.nomoreparties.co${movie.image.url}`\r\n                    : `${movie.image}`}\r\n                    alt=\"Изображение фильма\"></img>\r\n            </Link>\r\n            <div className=\"moviesCard__container\">\r\n                <h2 className=\"moviesCard__name\">{movie.nameRU}</h2>\r\n                {\r\n                    pathname === \"/saved-movies\"\r\n                        ? <button className=\"moviesCard__button\"><img src={deleteButton} onClick={() => deleteMovie(movie)}\r\n                            alt=\"Изображение крестика\"></img></button>\r\n                        : <button\r\n                            className=\"moviesCard__button\"><img onClick={changeLikeState} src={isLiked ? buttonLikeImage : buttnNoLikeImage}\r\n                                alt=\"Изображение сердца\"></img></button>\r\n                }\r\n            </div>\r\n            <p className=\"moviesCard__movie-time\">{numberToTime(movie.duration)}</p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default MoviesCard;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}